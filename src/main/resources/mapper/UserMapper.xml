<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
    <mapper namespace="com.tarzan.module.admin.mapper.UserMapper">

    <select id="selectUsers" resultType="com.tarzan.module.admin.model.User" parameterType="com.tarzan.module.admin.model.User">
        SELECT
        u.id,
        u.username,
        u.email,
        u.phone,
        u.status,
        GROUP_CONCAT(r.NAME) AS role_name
        FROM
        sys_user u
        LEFT JOIN sys_user_role ur ON u.id = ur.user_id
        LEFT JOIN sys_role r ON ur.role_id = r.id
        WHERE
        u.STATUS = 1
        <if test="user.username !=null and user.username != ''">
            AND u.username like concat('%', #{user.username}, '%')
        </if>
        <if test="user.email !=null and user.email != ''">
            AND u.email like concat('%', #{user.email}, '%')
        </if>
        <if test="user.phone !=null and user.phone != ''">
            AND u.phone like concat('%', #{user.phone}, '%')
        </if>
        GROUP BY u.id
    </select>

    <select id="findByRoleId" resultType="com.tarzan.module.admin.model.User">
        SELECT
            a.id,
            a.username,
            a.PASSWORD,
            a.salt,
            a.email,
            a.phone,
            a.sex,
            a.age,
            a.STATUS,
            a.create_time,
            a.update_time,
            a.last_login_time
        FROM
            sys_user a
                INNER JOIN sys_user_role b ON a.id = b.user_id
        WHERE b.role_id = #{roleId,jdbcType=VARCHAR}
    </select>

    <select id="findByRoleIds" resultType="com.tarzan.module.admin.model.User">
        SELECT
        a.id,
        a.username,
        a.PASSWORD,
        a.salt,
        a.email,
        a.phone,
        a.sex,
        a.age,
        a.STATUS,
        a.create_time,
        a.update_time,
        a.last_login_time
        FROM
        sys_user a
        INNER JOIN sys_user_role b ON a.id = b.user_id
        WHERE b.role_id IN
        <foreach collection="list" item="item" index="index" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>

</mapper>